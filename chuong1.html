<!DOCTYPE html>
<html lang="en">

<head>
    <title>Chuồng 1</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" sizes="32x32" href="/image/livestock.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="base.css">
    <link rel="stylesheet" href="./fontawesome-free-6.4.2-web/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

</head>

<body>
    <div class="website">
        <header class="header">
            <div class="grid">
                <div class="header__name">
                    <ul class="header__name-list">
                        <li class="list-item list-img">
                            <a href="index.html" class="home__logo"><img src="./image/logo.png" alt=""
                                    class="logo-img"></a>
                        </li>
                        <li class="list-item list-name">
                            <span class="header__title">Smart Chicken Farm</span>
                        </li>
                    </ul>
                    <ul class="header__change-chuong header__name-list">
                        <li class="list-link"><a href="index.html"
                                class="header__link-chuong1 side__link list-item">Home</a></li>
                        <li class="list-link"><a href="chuong2.html"
                                class="header__link-chuong1 side__link list-item">Coop 2</a></li>
                    </ul>
                    <ul class="list-time">
                        <li id="time"></li>
                        <li id="date"></li>
                    </ul>
                </div>
            </div>
        </header>

        <div class="container">

            <div class="container__function">
                <div class="image">
                    <div class="nhietdo">
                        <h1 class="h__img"><img src="./image/nhietdo1.png" alt="Nhiệt độ" class="nd__img"></h1>
                        <h3 id="nd__content"></h3>
                        <h2 class="nd__text">Temperature(ºC)</h2>
                    </div>
                    <div class="doam">
                        <h1 class="h__img"><img src="./image/doam1.png" alt="Độ ẩm" class="da__img"></h1>
                        <h3 id="da__content"></h3>
                        <h2 class="da__text">Humidity(%)</h2>
                    </div>
                    <div class="khoi">
                        <h1 class="h__img"><img src="./image/carbon-neutral.png" alt="Khói" class="khoi__img"></h1>
                        <h3 id="khoi__content"></h3>
                        <h2 class="khoi__text">CO2(%)</h2>
                    </div>
                </div>
                <div class="chart">
                    <canvas id="myChart" style="width:50%;max-width:300px;"></canvas>
                    <canvas id="myChart2" style="width:50%;max-width:300px;"></canvas>
                    <canvas id="myChart3" style="width:50%;max-width:300px;"></canvas>
                </div>
                <div class="control">
                    <div class="control__feed">
                        <img src="./image/feed.jpg" alt="" class="control__feed__img" id="Feeding1">
                        <button class="btn" , id="control__feed__on">Feed</button>
                    </div>
                    <div class="control__light">
                        <img src="./image/turned-off.png" alt="" class="control__light__img" , id="Light">
                        <div class="control__light__btn">
                            <input type="range" min="1" max="100" value="1" class="slider" id="myRange">
                            <p><strong>Light_mode: <span class="text" id="demo"></span></strong></p>
                        </div>
                    </div>
                    <div class="control__air">
                        <img src="./image/fan_off.png" alt="" class="control__air__img" id="Fan">
                        <div class="control__air__btn">
                            <button class="btn" , id="control__air__on">On</button>
                            <button class="btn" , id="control__air__off">Off</button>
                        </div>
                    </div>
                </div>

            </div>

            <div class="container__change-side">
                <div class="container__chuongName">
                    <span id="chuongName">Coop 1</span>
                </div>
            </div>


        </div>


        <!-- chart -->
        <!-- <div class="container">

            <canvas id="canvas"></canvas>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script> -->
        <div class="footer">
            <footer class="footer__content">
                <h1 class="footer__conclusion">Designed by Nguyen and Thuan</h1>
                <div class="footer__find-link">
                    <ul class="footer__link">
                        <li class="footer__title">Contact us: </li>
                        <li class="footer__title">
                            Nguyễn Kiến Nguyên: 21139081@student.hcmute.edu.vn
                            <a href="https://www.facebook.com/profile.php?id=100014076796852" target="_blank"
                                class="header__nav-icon-link">
                                <i class="header__nav-icon fa-brands fa-facebook"></i>
                            </a>
                        </li>
                        <li class="footer__title">
                            Phan Thành Thuận: 21139056@student.hcmute.edu.vn
                            <a href="https://www.facebook.com/phanthuan08" target="blank" class="header__nav-icon-link">
                                <i class="header__nav-icon fa-brands fa-facebook"></i>
                            </a>
                        </li>
                    </ul>
                    <ul class="footer__logo">
                        <img src="./image/ute.png" alt="" class="logo__hcmute">
                        <img src="./image/feeetranss.png" alt="" class="logo__feee">
                    </ul>
                </div>


            </footer>
        </div>

    </div>
    <script>
        function dongho() {
            var time = new Date();
            var gio = time.getHours();
            var phut = time.getMinutes();
            var giay = time.getSeconds();
            if (gio < 10)
                gio = "0" + gio;
            if (phut < 10)
                phut = "0" + phut;
            if (giay < 10)
                giay = "0" + giay;
            document.getElementById("time").innerHTML = gio + ":" + phut + ":" + giay;
            setTimeout("dongho()", 1000);
        };
        dongho();
    </script>
    <script>
        var curDate = new Date();

        // Ngày hiện tại
        var curDay = curDate.getDate();

        // Tháng hiện tại
        var curMonth = curDate.getMonth() + 1;

        // Năm hiện tại
        var curYear = curDate.getFullYear();

        // Gán vào thẻ HTML
        document.getElementById('date').innerHTML = curDay + "/" + curMonth + "/" + curYear;
    </script>

    <script src="functionChuong1.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-database.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.2.10/firebase-analytics.js"></script>

    <script>
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
            apiKey: "AIzaSyBUq1d6LTjhXJkb9GPj5sqI2EVLwCeP2yc",
            authDomain: "nkn-ptt.firebaseapp.com",
            databaseURL: "https://nkn-ptt-default-rtdb.firebaseio.com",
            projectId: "nkn-ptt",
            storageBucket: "nkn-ptt.appspot.com",
            messagingSenderId: "218429293202",
            appId: "1:218429293202:web:60c68bf1ae89434d185c4b",
            measurementId: "G-0D3YWGM7TE"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
    </script>

    <script>
        //function
        var nhietDo = document.getElementById('nd__content');
        var dbRef = firebase.database().ref('chuong1').child('Nhietdo');
        var doAm = document.getElementById('da__content');
        var dbRef2 = firebase.database().ref('chuong1').child('Doam');
        var Khoi = document.getElementById('khoi__content');
        var dbRef3 = firebase.database().ref('chuong1').child('Khoi');
        var quatRef = firebase.database().ref('chuong1').child('Quat');
        var DenRef = firebase.database().ref('chuong1').child('Den');
        var FeedRef = firebase.database().ref('chuong1').child('Cho_an');

        dbRef.on('value', function (snapshot1) {
            var nhietdoValue = snapshot1.val();
            nhietDo.innerHTML = nhietdoValue;
        });

        dbRef2.on('value', function (snapshot2) {
            var doamValue = snapshot2.val();
            doAm.innerHTML = doamValue;
        });

        dbRef3.on('value', function (snapshot3) {
            var KhoiValue = snapshot3.val();
            Khoi.innerHTML = KhoiValue;
        });
    </script>


    <!-- chart -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

    <script>
        const xValues = [];
        const yValues = [];
        var barColors = ["blue"];
        const barThickness = 10; // Độ rộng của các cột
        const ctx = document.getElementById('myChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: xValues,
                datasets: [{
                    backgroundColor: barColors,
                    data: yValues,
                    barThickness: barThickness
                }]
            },
            options: {
                legend: { display: false },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            suggestedMax: 100
                        }
                    }],
                }
            }
        });

        // Hàm cập nhật dữ liệu và vẽ lại biểu đồ
        function updateChart() {
            // Lấy thời gian cập nhật mới
            const currentTime = new Date().toLocaleTimeString();
            const newYValue = parseFloat(nhietDo.innerHTML);
            // Cập nhật mảng xValues
            xValues.push(currentTime);
            yValues.push(newYValue);
            // Giới hạn số lượng điểm dữ liệu hiển thị trên biểu đồ (tối đa 5 cột)
            const maxDataPoints = 5;
            if (xValues.length > maxDataPoints) {
                xValues.shift(); // Xóa đi điểm dữ liệu cũ nhất
            }
            if (yValues.length > maxDataPoints) {
                yValues.shift(); // Xóa đi điểm dữ liệu cũ nhất
            }

            // Cập nhật màu của từng cột dựa trên giá trị nhietDo
            barColors.length = 0; // Xóa màu hiện tại

            for (let i = 0; i < yValues.length; i++) {
                if (yValues[i] > 40) {
                    barColors.push("red"); // Nếu nhietDo > 40, thì đổi màu thành đỏ
                } else {
                    barColors.push("blue"); // Nếu nhietDo <= 40, thì giữ màu xanh
                }
            }

            // Cập nhật dữ liệu trên biểu đồ
            chart.data.datasets[0].data = yValues;
            chart.data.labels = xValues;
            chart.update(); // Vẽ lại biểu đồ
        }

        // Gọi hàm updateChart() sau mỗi 5 giây
        setInterval(updateChart, 5000);
    </script>

    <script>
        const xValues2 = [];
        const yValues2 = [];
        const barColors2 = ["blue"];
        const barThickness2 = 10; // Độ rộng của các cột
        const ctx2 = document.getElementById('myChart2').getContext('2d');
        const chart2 = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: xValues2,
                datasets: [{
                    backgroundColor: barColors2,
                    data: yValues2,
                    barThickness: barThickness
                }]
            },
            options: {
                legend: { display: false },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            suggestedMax: 100
                        }
                    }],
                }
            }
        });

        // Hàm cập nhật dữ liệu và vẽ lại biểu đồ
        function updateChart2() {
            // Lấy thời gian cập nhật mới
            const currentTime2 = new Date().toLocaleTimeString();
            const newYValue2 = parseFloat(doAm.innerHTML);
            // Cập nhật mảng xValues
            xValues2.push(currentTime2);
            yValues2.push(newYValue2);
            // Giới hạn số lượng điểm dữ liệu hiển thị trên biểu đồ (tối đa 5 cột)
            const maxDataPoints2 = 5;
            if (xValues2.length > maxDataPoints2) {
                xValues2.shift(); // Xóa đi điểm dữ liệu cũ nhất
            }
            if (yValues2.length > maxDataPoints2) {
                yValues2.shift(); // Xóa đi điểm dữ liệu cũ nhất
            }

            // barColors2.length = 0; // Xóa màu hiện tại
            barColors2.push("blue");
            // for (let i = 0; i < yValues2.length; i++) {
            //     if (yValues2[i] > 70 || yValues2[i] < 60) {
            //         barColors2.push("red"); // Nếu nhietDo > 40, thì đổi màu thành đỏ
            //     } else {
            //         barColors2.push("blue"); // Nếu nhietDo <= 40, thì giữ màu xanh
            //     }
            // }

            // Cập nhật dữ liệu trên biểu đồ
            chart2.data.datasets[0].data = yValues2;
            chart2.data.labels = xValues2;
            chart2.update(); // Vẽ lại biểu đồ
        }

        // Gọi hàm updateChart2() sau mỗi 5 giây
        setInterval(updateChart2, 5000);
    </script>

    <script>
        const xValues3 = [];
        const yValues3 = [];
        const barColors3 = ["blue"];
        const barThickness3 = 10; // Độ rộng của các cột
        const ctx3 = document.getElementById('myChart3').getContext('2d');
        const chart3 = new Chart(ctx3, {
            type: 'bar',
            data: {
                labels: xValues3,
                datasets: [{
                    backgroundColor: barColors3,
                    data: yValues3,
                    barThickness: barThickness
                }]
            },
            options: {
                legend: { display: false },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            suggestedMax: 100
                        }
                    }],
                }
            }
        });

        // Hàm cập nhật dữ liệu và vẽ lại biểu đồ
        function updateChart3() {
            // Lấy thời gian cập nhật mới
            const currentTime3 = new Date().toLocaleTimeString();
            const newYValue3 = parseFloat(Khoi.innerHTML);
            // Cập nhật mảng xValues
            xValues3.push(currentTime3);
            yValues3.push(newYValue3);
            // Giới hạn số lượng điểm dữ liệu hiển thị trên biểu đồ (tối đa 5 cột)
            const maxDataPoints3 = 5;
            if (xValues3.length > maxDataPoints3) {
                xValues3.shift(); // Xóa đi điểm dữ liệu cũ nhất
            }
            if (yValues3.length > maxDataPoints3) {
                yValues3.shift(); // Xóa đi điểm dữ liệu cũ nhất
            }

            barColors3.length = 0; // Xóa màu hiện tại

            for (let i = 0; i < yValues3.length; i++) {
                if (yValues3[i] > 1000) {
                    barColors3.push("red"); // Nếu nhietDo > 40, thì đổi màu thành đỏ
                } else {
                    barColors3.push("blue"); // Nếu nhietDo <= 40, thì giữ màu xanh
                }
            }

            // Cập nhật dữ liệu trên biểu đồ
            chart3.data.datasets[0].data = yValues3;
            chart3.data.labels = xValues3;
            chart3.update(); // Vẽ lại biểu đồ
        }

        // Gọi hàm updateChart2() sau mỗi 5 giây
        setInterval(updateChart3, 5000);
    </script>


</body>

</html>